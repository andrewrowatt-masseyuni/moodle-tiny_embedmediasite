{"version":3,"file":"ui.min.js","names":["define","_exports","_modal","_templates","_notification","_repository","_interopRequireDefault","e","__esModule","default","_regenerator","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","this","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","handleAction","_ref","_callee","editor","_context","displayDialogue","_x","_ref2","_callee5","page","presentations","modal","loadingIndicator","noMoreContentIndicator","loadMoreContent","_loadMoreContent","observer","_context5","_callee4","pageNumber","_presentations$list","_yield$Templates$rend2","html","js","_context4","getMyMediasitePresentations","catch","error","exception","list","renderForPromise","appendNodeContents","_x4","templateContext","large","removeOnClose","show","document","getElementById","addEventListener","_ref3","_callee2","event","target","mode","source","title","templateName","_yield$Templates$rend","_context2","classList","contains","preventDefault","dataset","insertContent","destroy","_x3","IntersectionObserver","_ref4","_callee3","entries","_context3","isIntersecting","unobserve","observe","style","display","_x5","root","threshold","rootMargin","_x2"],"sources":["../src/ui.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module ui\n *\n * @module     tiny_embedmediasite/ui\n * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport EmbedMediasiteModal from './modal';\nimport Templates from 'core/templates';\nimport {exception as displayException} from 'core/notification';\nimport {getMyMediasitePresentations} from './repository';\n\n/**\n * Handle action\n *\n * @param {TinyMCE} editor\n */\nexport const handleAction = async(editor) => {\n    displayDialogue(editor);\n};\n\n/**\n * Display modal\n *\n * @param  {TinyMCE} editor\n */\nconst displayDialogue = async(editor) => {\n    let page = 1; // Track which \"page\" of data to load\n\n    // Get first page of presentations. The template (mostly) handles the case of zero presentations.\n    let presentations = await getMyMediasitePresentations(page)\n            .catch((error) => displayException(error));\n\n    // Show modal with buttons.\n    const modal = await EmbedMediasiteModal.create({\n        templateContext: presentations,\n        large: true,\n        removeOnClose: true,\n    });\n\n    await modal.show();\n\n    const contentContainer = document.getElementById('tiny_embedmediasite_content-container');\n    contentContainer.addEventListener('click', async event => {\n        const target = event.target;\n        if (target && target.classList.contains('tiny-embedmediasite-insert-button')) {\n            event.preventDefault();\n            const mode = target.dataset.mode;\n            const source = target.dataset.source;\n            const title = target.dataset.title;\n\n            let templateName;\n            if (mode === 'linkonly') {\n                templateName = 'tiny_embedmediasite/_linkonly';\n            } else {\n                // Default to embed mode\n                templateName = 'tiny_embedmediasite/_embedlink';\n            }\n\n            const {html} = await Templates.renderForPromise(\n                templateName, {\n                    source: source,\n                    title: title\n                });\n            editor.insertContent(html);\n            modal.destroy();\n        }\n    });\n\n    const loadingIndicator = document.getElementById('tiny_embedmediasite_loading');\n    const noMoreContentIndicator = document.getElementById('tiny_embedmediasite_no_more_content');\n\n    /**\n     * Load the second and subsequent pages of content.\n     *\n     * @param {*} pageNumber\n     * @return {number} Number of presentations loaded\n     */\n    async function loadMoreContent(pageNumber) {\n        // Get a page of presentations.\n        const presentations = await getMyMediasitePresentations(pageNumber)\n            .catch((error) => displayException(error));\n\n        if (!presentations.list?.length) {\n            // Short circuit if no presentations.\n            return 0;\n        }\n\n        // Render and append the new presentations.\n        const {html, js} = await Templates.renderForPromise(\n            'tiny_embedmediasite/_presentations',\n            presentations\n        );\n        Templates.appendNodeContents('#tiny_embedmediasite_content-container', html, js);\n        return presentations.list.length;\n    }\n\n    // Set up the Intersection Observer\n    const observer = new IntersectionObserver(async entries => {\n        // Check if the loading indicator is visible\n        if (entries[0].isIntersecting) {\n            // Stop observing temporarily to prevent multiple calls while loading\n            observer.unobserve(loadingIndicator);\n\n            page++;\n            if (await loadMoreContent(page)) {\n                // Re-observe the indicator after fetch completes\n                observer.observe(loadingIndicator);\n            } else {\n                // No more data to load; hide the loading indicator\n                loadingIndicator.style.display = 'none';\n                noMoreContentIndicator.style.display = 'block';\n            }\n        }\n    }, {\n        root: null, // Observe the viewport\n        threshold: 1.0, // Trigger when 100% of the indicator is visible\n        rootMargin: '0px'\n    });\n\n    // Start observing the loading indicator element\n    observer.observe(loadingIndicator);\n};\n"]}