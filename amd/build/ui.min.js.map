{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module ui\n *\n * @module     tiny_embedmediasite/ui\n * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport EmbedMediasiteModal from './modal';\nimport Templates from 'core/templates';\nimport {exception as displayException} from 'core/notification';\nimport {getMyMediasitePresentations} from './repository';\n// import ModalEvents from 'core/modal_events';\n// import {get_strings as getStrings} from 'core/str';\n\n/**\n * Handle action\n *\n * @param {TinyMCE} editor\n */\nexport const handleAction = async(editor) => {\n    displayDialogue(editor);\n};\n\n/**\n * Display modal\n *\n * @param  {TinyMCE} editor\n */\n// eslint-disable-next-line no-unused-vars\nconst displayDialogue = async(editor) => {\n    let page = 1; // Track which \"page\" of data to load\n\n    // Get first page of presentations. The template (mostly) handles the case of zero presentations.\n    let presentations = await getMyMediasitePresentations(page)\n            .catch((error) => displayException(error));\n\n    // Show modal with buttons.\n    const modal = await EmbedMediasiteModal.create({\n        templateContext: {presentations: presentations},\n        large: true,\n        removeOnClose: true,\n    });\n\n    await modal.show();\n\n    const loadingIndicator = document.getElementById('tiny_embedmediasite_loading');\n    const noMoreContentIndicator = document.getElementById('tiny_embedmediasite_no_more_content');\n\n    /**\n     * Load the second and subsequent pages of content.\n     *\n     * @param {*} pageNumber\n     * @return {number} Number of presentations loaded\n     */\n    async function loadMoreContent(pageNumber) {\n        // Get a page of presentations.\n        const presentations = await getMyMediasitePresentations(pageNumber)\n            .catch((error) => displayException(error));\n\n        if (!presentations?.length) {\n            // Short circuit if no presentations.\n            return 0;\n        }\n\n        // Render and append the new presentations.\n        const {html, js} = await Templates.renderForPromise(\n            'tiny_embedmediasite/_presentations',\n            {presentations: presentations}\n        );\n        Templates.appendNodeContents('#tiny_embedmediasite_content-container', html, js);\n        return presentations.length;\n    }\n\n    // Set up the Intersection Observer\n    const observer = new IntersectionObserver(async entries => {\n        // Check if the loading indicator is visible\n        if (entries[0].isIntersecting) {\n            // Stop observing temporarily to prevent multiple calls while loading\n            observer.unobserve(loadingIndicator);\n\n            page++;\n            if (await loadMoreContent(page)) {\n                // Re-observe the indicator after fetch completes\n                observer.observe(loadingIndicator);\n            } else {\n                // No more data to load; hide the loading indicator\n                loadingIndicator.style.display = 'none';\n                noMoreContentIndicator.style.display = 'block';\n            }\n        }\n    }, {\n        root: null, // Observe the viewport\n        threshold: 1.0, // Trigger when 100% of the indicator is visible\n        rootMargin: '0px'\n    });\n\n    // Start observing the loading indicator element\n    observer.observe(loadingIndicator);\n};\n"],"names":["async","displayDialogue","editor","page","presentations","catch","error","modal","EmbedMediasiteModal","create","templateContext","large","removeOnClose","show","loadingIndicator","document","getElementById","noMoreContentIndicator","observer","IntersectionObserver","entries","isIntersecting","unobserve","pageNumber","length","html","js","Templates","renderForPromise","appendNodeContents","loadMoreContent","observe","style","display","root","threshold","rootMargin"],"mappings":";;;;;;;oMAmC4BA,MAAAA,SACxBC,gBAAgBC,eASdD,gBAAkBD,MAAAA,aAChBG,KAAO,EAGPC,oBAAsB,2CAA4BD,MAC7CE,OAAOC,QAAU,2BAAiBA,eAGrCC,YAAcC,eAAoBC,OAAO,CAC3CC,gBAAiB,CAACN,cAAeA,eACjCO,OAAO,EACPC,eAAe,UAGbL,MAAMM,aAENC,iBAAmBC,SAASC,eAAe,+BAC3CC,uBAAyBF,SAASC,eAAe,6CA4BjDE,SAAW,IAAIC,sBAAqBnB,MAAAA,UAElCoB,QAAQ,GAAGC,iBAEXH,SAASI,UAAUR,kBAEnBX,4BA1BuBoB,kBAErBnB,oBAAsB,2CAA4BmB,YACnDlB,OAAOC,QAAU,2BAAiBA,YAElCF,MAAAA,gBAAAA,cAAeoB,cAET,QAILC,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAC/B,qCACA,CAACxB,cAAeA,0CAEVyB,mBAAmB,yCAA0CJ,KAAMC,IACtEtB,cAAcoB,OAWPM,CAAgB3B,MAEtBe,SAASa,QAAQjB,mBAGjBA,iBAAiBkB,MAAMC,QAAU,OACjChB,uBAAuBe,MAAMC,QAAU,YAGhD,CACCC,KAAM,KACNC,UAAW,EACXC,WAAY,QAIhBlB,SAASa,QAAQjB"}