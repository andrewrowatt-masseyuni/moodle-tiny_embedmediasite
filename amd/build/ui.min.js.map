{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module ui\n *\n * @module     tiny_embedmediasite/ui\n * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport EmbedMediasiteModal from './modal';\nimport Templates from 'core/templates';\nimport {exception as displayException} from 'core/notification';\nimport {getMyMediasitePresentations} from './repository';\n// import ModalEvents from 'core/modal_events';\n// import {get_strings as getStrings} from 'core/str';\n\n/**\n * Handle action\n *\n * @param {TinyMCE} editor\n */\nexport const handleAction = async(editor) => {\n    displayDialogue(editor);\n};\n\n/**\n * Display modal\n *\n * @param  {TinyMCE} editor\n */\nconst displayDialogue = async(editor) => {\n    const data = Object.assign({}, {});\n\n    // Show modal with buttons.\n    const modal = await EmbedMediasiteModal.create({\n        templateContext: await getTemplateContext(editor, data),\n        large: true,\n        removeOnClose: true,\n    });\n\n    await modal.show();\n\n    // const contentContainer = document.getElementById('tiny_embedmediasite_content-container');\n    const loadingIndicator = document.getElementById('tiny_embedmediasite_loading');\n    let page = 1; // Track which \"page\" of data to load\n\n    /**\n     * Load the second and subsequent pages of content.\n     *\n     * @param {*} pageNumber\n     */\n    function loadMoreContent(pageNumber) {\n        const presentations = getMyMediasitePresentations(pageNumber);\n        presentations.then(newPresentations => {\n            // eslint-disable-next-line promise/no-nesting\n            Templates.renderForPromise('tiny_embedmediasite/_presentations',\n                {presentations: newPresentations}).then(({html, js}) => {\n                    Templates.appendNodeContents('#tiny_embedmediasite_content-container', html, js);\n                return newPresentations;\n            })\n            // Deal with this exception (Using core/notify exception function is recommended).\n            .catch((error) => displayException(error));\n\n            return newPresentations;\n        }).catch(error => {\n            window.console.error('Error loading more content:', error);\n        });\n    }\n\n    // Set up the Intersection Observer\n    const observer = new IntersectionObserver(entries => {\n        window.console.log('IntersectionObserver', entries[0]);\n        // Check if the loading indicator is visible\n        if (entries[0].isIntersecting) {\n            // Stop observing temporarily to prevent multiple calls while loading\n            observer.unobserve(loadingIndicator);\n\n            page++;\n            loadMoreContent(page);\n\n            // Re-observe the indicator after a short delay (or after fetch completes)\n            setTimeout(() => {\n                observer.observe(loadingIndicator);\n            }, 500);\n\n            // Optional: In a real app, if no more data is available,\n            // you would stop observing the target permanently and hide the indicator.\n        }\n    }, {\n        root: null, // Observe the viewport\n        threshold: 1.0, // Trigger when 100% of the indicator is visible\n        rootMargin: '0px'\n    });\n\n    // Start observing the loading indicator element\n    observer.observe(loadingIndicator);\n};\n\n/**\n * Get the template context for the dialogue.\n *\n * @param {Editor} editor\n * @param {object} data\n * @returns {object} data\n */\nconst getTemplateContext = async(editor, data) => {\n    const page = 1;\n    return Object.assign({}, {\n        presentations: await getMyMediasitePresentations(page),\n    }, data);\n};\n"],"names":["async","displayDialogue","editor","data","Object","assign","modal","EmbedMediasiteModal","create","templateContext","getTemplateContext","large","removeOnClose","show","loadingIndicator","document","getElementById","page","observer","IntersectionObserver","entries","pageNumber","window","console","log","isIntersecting","unobserve","then","newPresentations","renderForPromise","presentations","_ref","html","js","appendNodeContents","catch","error","setTimeout","observe","root","threshold","rootMargin"],"mappings":";;;;;;;oMAmC4BA,MAAAA,SACxBC,gBAAgBC,eAQdD,gBAAkBD,MAAAA,eACdG,KAAOC,OAAOC,OAAO,GAAI,IAGzBC,YAAcC,eAAoBC,OAAO,CAC3CC,sBAAuBC,mBAAmBR,OAAQC,MAClDQ,OAAO,EACPC,eAAe,UAGbN,MAAMO,aAGNC,iBAAmBC,SAASC,eAAe,mCAC7CC,KAAO,QA0BLC,SAAW,IAAIC,sBAAqBC,cAnBjBC,WAoBrBC,OAAOC,QAAQC,IAAI,uBAAwBJ,QAAQ,IAE/CA,QAAQ,GAAGK,iBAEXP,SAASQ,UAAUZ,kBAEnBG,OA1BiBI,WA2BDJ,MA1BE,2CAA4BI,YACpCM,MAAKC,sCAELC,iBAAiB,qCACvB,CAACC,cAAeF,mBAAmBD,MAAKI,WAACC,KAACA,KAADC,GAAOA,mCAClCC,mBAAmB,yCAA0CF,KAAMC,IAC1EL,oBAGVO,OAAOC,QAAU,2BAAiBA,SAE5BR,oBACRO,OAAMC,QACLd,OAAOC,QAAQa,MAAM,8BAA+BA,UAgBpDC,YAAW,KACPnB,SAASoB,QAAQxB,oBAClB,QAKR,CACCyB,KAAM,KACNC,UAAW,EACXC,WAAY,QAIhBvB,SAASoB,QAAQxB,mBAUfJ,mBAAqBV,MAAME,OAAQC,OAE9BC,OAAOC,OAAO,GAAI,CACrByB,oBAAqB,2CAFZ,IAGV3B"}